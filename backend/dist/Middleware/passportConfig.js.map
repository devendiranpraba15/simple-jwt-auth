{"version":3,"file":"passportConfig.js","names":["_fs","_interopRequireDefault","require","_path","_passport","_passportJwt","_Users","pathToKey","path","join","__dirname","PUB_KEY","fs","readFileSync","options","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","secretOrKey","algorithms","passport","use","JwtStrategy","_ref","_asyncToGenerator2","_regenerator","mark","_callee","jwt_payload","done","user","wrap","_callee$","_context","prev","next","UsersModel","findOne","uid","sub","sent","abrupt","t0","stop","_x","_x2","apply","arguments","_default","exports"],"sources":["../../src/Middleware/passportConfig.js"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\nimport passport from 'passport';\r\nimport { Strategy as JwtStrategy, ExtractJwt } from 'passport-jwt';\r\nimport UsersModel from '../Model/Sequelize/Users';\r\n\r\nconst pathToKey = path.join(__dirname, '..', 'id_rsa_pub.pem');\r\nconst PUB_KEY = fs.readFileSync(pathToKey, 'utf8');\r\n\r\nconst options = {\r\n  jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\r\n  secretOrKey: PUB_KEY,\r\n  algorithms: ['RS256'],\r\n};\r\n\r\npassport.use(\r\n  new JwtStrategy(options, async (jwt_payload, done) => {\r\n    try {\r\n      const user = await UsersModel.findOne({ uid: jwt_payload.sub });\r\n      if (user) {\r\n        return done(null, user);\r\n      } else {\r\n        return done(null, false);\r\n      }\r\n    } catch (err) {\r\n      return done(err, false);\r\n    }\r\n  })\r\n);\r\n\r\nexport default passport;\r\n"],"mappings":"oWAAA,IAAAA,GAAA,CAAAC,sBAAA,CAAAC,OAAA,QACA,IAAAC,KAAA,CAAAF,sBAAA,CAAAC,OAAA,UACA,IAAAE,SAAA,CAAAH,sBAAA,CAAAC,OAAA,cACA,IAAAG,YAAA,CAAAH,OAAA,iBACA,IAAAI,MAAA,CAAAL,sBAAA,CAAAC,OAAA,8BAEA,GAAM,CAAAK,SAAS,CAAGC,gBAAI,CAACC,IAAI,CAACC,SAAS,CAAE,IAAI,CAAE,gBAAgB,CAAC,CAC9D,GAAM,CAAAC,OAAO,CAAGC,cAAE,CAACC,YAAY,CAACN,SAAS,CAAE,MAAM,CAAC,CAElD,GAAM,CAAAO,OAAO,CAAG,CACdC,cAAc,CAAEC,uBAAU,CAACC,2BAA2B,CAAC,CAAC,CACxDC,WAAW,CAAEP,OAAO,CACpBQ,UAAU,CAAE,CAAC,OAAO,CACtB,CAAC,CAEDC,oBAAQ,CAACC,GAAG,CACV,GAAI,CAAAC,qBAAW,CAACR,OAAO,6BAAAS,IAAA,IAAAC,kBAAA,0BAAAC,YAAA,YAAAC,IAAA,CAAE,SAAAC,QAAOC,WAAW,CAAEC,IAAI,MAAAC,IAAA,QAAAL,YAAA,YAAAM,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,SAE1B,CAAAC,iBAAU,CAACC,OAAO,CAAC,CAAEC,GAAG,CAAEV,WAAW,CAACW,GAAI,CAAC,CAAC,QAAzDT,IAAI,CAAAG,QAAA,CAAAO,IAAA,KACNV,IAAI,EAAAG,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAQ,MAAA,UACCZ,IAAI,CAAC,IAAI,CAAEC,IAAI,CAAC,gBAAAG,QAAA,CAAAQ,MAAA,UAEhBZ,IAAI,CAAC,IAAI,CAAE,KAAK,CAAC,SAAAI,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAC,IAAA,IAAAD,QAAA,CAAAS,EAAA,CAAAT,QAAA,oBAAAA,QAAA,CAAAQ,MAAA,UAGnBZ,IAAI,CAAAI,QAAA,CAAAS,EAAA,CAAM,KAAK,CAAC,2BAAAT,QAAA,CAAAU,IAAA,MAAAhB,OAAA,iBAE1B,mBAAAiB,EAAA,CAAAC,GAAA,SAAAtB,IAAA,CAAAuB,KAAA,MAAAC,SAAA,QACH,CAAC,CAAC,IAAAC,QAAA,CAAAC,OAAA,YAEa7B,oBAAQ","ignoreList":[]}