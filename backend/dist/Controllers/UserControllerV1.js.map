{"version":3,"file":"UserControllerV1.js","names":["_sequelize","require","_Users","_interopRequireDefault","_auth","_token","exports","UserListing","_UserListing","_asyncToGenerator2","_regenerator","mark","_callee","req","res","wrap","_callee$","_context","prev","next","UsersModel","findAll","attributes","order","then","rawData","map","r","toJSON","usersList","status","send","success","message","body","total","length","err","details","stop","_x","_x2","apply","arguments","RegisterUser","_RegisterUser","_callee2","_callee2$","_context2","count","where","_defineProperty2","Op","or","email","username","json","saltHash","genPassword","password","passwordSalt","salt","passwordHash","hash","create","fullname","pwd_salt","pwd_hash","roles","role","photo","is_active","isActive","newUser","user","console","error","_x3","_x4","UserLogin","_UserLogin","_callee3","_callee3$","_context3","findOne","msg","isValid","validPassword","tokenObject","issueJWT","token","expiresIn","expires","_x5","_x6","module"],"sources":["../../src/Controllers/UserControllerV1.js"],"sourcesContent":["import { Op } from 'sequelize';\r\nimport UsersModel from '../Model/Sequelize/Users';\r\nimport { genPassword, validPassword } from '../Utils/auth';\r\nimport { issueJWT } from '../Utils/token';\r\n\r\nconst exports = {\r\n  UserListing: async (req, res) => {\r\n    UsersModel.findAll({\r\n      attributes: ['uid', 'fullname', 'username', 'email', 'role', 'photo'],\r\n      order: [['username', 'ASC']],\r\n    })\r\n      .then((rawData) => rawData.map((r) => r.toJSON()))\r\n      .then((usersList) => {\r\n        res.status(200).send({\r\n          success: true,\r\n          message: 'User Listing successfully.',\r\n          body: usersList,\r\n          total: usersList.length,\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        res.status(500).send({\r\n          success: false,\r\n          message: 'Error occurred while Fetching the user details',\r\n          details: err,\r\n        });\r\n      });\r\n  },\r\n  RegisterUser: async (req, res) => {\r\n    UsersModel.count({\r\n      where: {\r\n        [Op.or]: [{ email: req.body.email }, { username: req.body.username }],\r\n      },\r\n    })\r\n      .then((count) => {\r\n        if (count > 0) {\r\n          // Email or username already exists\r\n          return res.status(400).json({ success: false, message: 'Email or username already exists.' });\r\n        } else {\r\n          const saltHash = genPassword(req.body.password);\r\n\r\n          const passwordSalt = saltHash.salt;\r\n          const passwordHash = saltHash.hash;\r\n\r\n          UsersModel.create({\r\n            username: req.body.username,\r\n            fullname: req.body.fullname,\r\n            email: req.body.email,\r\n            pwd_salt: passwordSalt,\r\n            pwd_hash: passwordHash,\r\n            roles: req.body.role,\r\n            photo: req.body.photo,\r\n            is_active: req.body.isActive,\r\n          })\r\n            .then((newUser) => {\r\n              if (newUser) {\r\n                return res\r\n                  .status(201)\r\n                  .json({ success: true, message: 'User created successfully.', user: newUser.toJSON() });\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              console.error(err);\r\n              return res\r\n                .status(500)\r\n                .json({ success: false, message: 'Error occurred while creating the user.', error: err });\r\n            });\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.error(err);\r\n        return res.status(500).json({ success: false, message: 'Error occurred while creating the user.', error: err });\r\n      });\r\n  },\r\n  UserLogin: async (req, res) => {\r\n    UsersModel.findOne({ where: { username: req.body.username } })\r\n      .then((user) => {\r\n        if (!user) {\r\n          return res.status(401).json({ success: false, msg: 'Could not find user' });\r\n        }\r\n\r\n        const isValid = validPassword(req.body.password, user.pwd_hash, user.pwd_salt);\r\n\r\n        if (isValid) {\r\n          const tokenObject = issueJWT(user);\r\n\r\n          res.status(200).json({ success: true, token: tokenObject.token, expiresIn: tokenObject.expires });\r\n        } else {\r\n          res.status(401).json({ success: false, msg: 'You entered the wrong password' });\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.error(err);\r\n        res.status(500).json({ success: false, message: 'Error occurred while checking the username', error: err });\r\n      });\r\n  },\r\n};\r\n\r\nmodule.exports = exports;\r\n"],"mappings":"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","ignoreList":[]}